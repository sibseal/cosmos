{% extends "main.html" %}
{% block content %}

<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel">Вы действительно хотите удалить задачу {{ task.name }}?</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Нет, не удалять</button>
                <a href="{% url 'products:delete_task' task_id %}" type="button" class="btn btn-danger float-end">Да, удалить</a>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="col"></div>
        <div class="col-11">
            <div class="card rounded">
                <div class="card-header">
                    <div class="container">
                        <div class="row">
                            <div class="col">
                                <a href="{% url 'products:execute' task_id %}" type="button" class="btn btn-success{% if not items or not criteria %} disabled {% endif %}">Рассчитать</a>
                            </div>
                            <div class="col-md-auto d-flex align-items-center">
                                <span>{{task.name}}</span>
                            </div>
                            <div class="col">
<!--                                <a href="{% url 'products:delete_task' task_id %}" type="button" class="btn btn-danger float-end">Удалить</a>-->
                                <!-- Button trigger modal -->
                                <button type="button" class="btn btn-danger float-end" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                                  Удалить
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <form id="form_update_task" action="{% url 'products:update_task_v2' task_id %}" method="post">
                        {% csrf_token %}
                        <table class="table table-borderless">
                            <tr>
                                <td>
                                    <div class="input-group flex-nowrap">
                                        {% if items and criteria %}
                                        <span class="input-group-text w-25 text-wrap"></span>
                                        {% endif %}
                                        {% for criterion in criteria %}
                                        <span class="form-control input-group-text">{{ criterion.name }}</span>
                                        {% endfor %}
                                    </div>
                                    {% for item, criterion in cells.items %}
                                    <div class="input-group flex-nowrap">
                                        <span class="input-group-text w-25">{{ item }}</span>
                                        {% for criterion, cell in criterion.items %}
                                        <input id="cell_{{ item.id }}_value"
                                               type="number"
                                               name="object-cell-{{ cell.id }}-value"
                                               class="form-control mb-0 {% if cell.changed %}text-warning{% endif %}"
                                               step="0.001" value="{{cell.value}}"
                                               onchange="this.form.submit()"/>
                                        {% endfor %}
                                    </div>
                                    {% endfor %}
                                </td>
                                <td>
                                    <a href="{% url 'products:add_criteria' task_id %}" type="button" class="btn btn-outline-primary">Критерии</a>
                                </td>
                            </tr>
                            <tr>
                                <td><a href="{% url 'products:add_items' task_id %}" type="button" class="btn btn-outline-primary">Варианты</a></td>
                                <td></td>
                            </tr>

                            {% if show_criterion_weight and cells.items %}
                            <!--                                {% if error_criteria_value_sum %}table-warning{% endif %}-->
                            <tr>
                                <td>
                                    <div class="input-group flex-nowrap">
                                        <span class="input-group-text w-25 {% if error_criteria_value_sum %}text-danger{% else %}text-success{% endif %}">Вероятность</span>
                                        {% for criterion in criteria %}
                                        <!--                                            {% if error_criteria_value_sum %}is-invalid{% endif %}-->
                                        <input class="form-control mb-0 {% if criterion.changed %}text-warning{% endif %}"
                                               id="object-criterion-{{ criterion.id }}-value"
                                               type="number"
                                               name="object-criterion-{{ criterion.id }}-value"
                                               step="0.001"
                                               value="{{criterion.value}}"
                                               onchange="this.form.submit()"/>
                                        {% endfor %}
                                    </div>
                                </td>
                                <!--                                    {% if error_criteria_value_sum %}-->
                                <!--                                    <td>-->
                                <!--                                        <div class="d-flex align-items-center" role="alert">-->
                                <!--                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-exclamation-triangle-fill flex-shrink-0 me-2"-->
                                <!--                                                 viewBox="0 0 16 16" role="img" aria-label="Warning:">-->
                                <!--                                                <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>-->
                                <!--                                            </svg>-->
                                <!--                                            <div>{{ error_criteria_value_sum }}</div>-->
                                <!--                                        </div>-->
                                <!--                                    </td>-->
                                <!--                                    {%endif%}-->
                            </tr>
                            {% endif %}

                            {% if show_criterion_direction and cells.items %}
                            <tr>
                                <td>
                                    <div class="input-group flex-nowrap">
                                        <span class="input-group-text w-25">Направление</span>
                                        {% for criterion in criteria %}
                                        <div class="d-flex justify-content-center form-control input-group-text">
                                            <input type="hidden" name="object-criterion-{{ criterion.id }}-direction_bool" value='False'/>
                                            <input type="checkbox" role="switch"
                                                   class="form-check-input mt-0 align-middle {% if criterion.changed %}text-warning{% endif %} form-check"
                                                   name="object-criterion-{{ criterion.id }}-direction_bool" value='True'
                                                   onchange="this.form.submit()" {% if criterion.direction_bool %} checked {% endif %}/>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </td>
                            </tr>
                            {% endif %}
                        </table>
                        {% if task.paramaux_set.all %}
                        <table class="table table-borderless">
                            <tr>
                                {% for param in task.paramaux_set.all %}
                                <td>
                                    <div class="input-group flex-nowrap">
                                        <span class="input-group-text w-50">{{ param.param.description }}</span>
                                        <input id="object-param-{{ param.id }}_value"
                                               type="number"
                                               name="object-param-{{ param.id }}-value"
                                               class="form-control {% if param.changed %}text-warning{% endif %}"
                                               step="0.001" value="{{param.value}}"
                                               onchange="this.form.submit()"/>
                                    </div>
                                </td>
                                {% if forloop.counter|divisibleby:3 %}
                                    </tr>
                                    <tr>
                                {% endif %}
                                {% endfor %}
                            </tr>
                        </table>
                        {% endif %}
                        {% if show_need_descartes_criterion or show_need_descartes_item %}

                        <table class="table table-borderless">
                            {% if show_need_descartes_criterion %}
                            {% if criteria %}
                            <tr>
                                <td colspan="2">
                                    <div class="input-group flex-nowrap">
                                        <span class="input-group-text w-25">Оценки</span>
                                        {% for criterion in criteria %}
                                        <span class="form-control input-group-text">{{ criterion.name }}</span>
                                        {% endfor %}
                                    </div>
                                    {% for criterion_i, criteria in cells_descartes_criteria.items %}
                                    <div class="input-group flex-nowrap">
                                        <span class="input-group-text w-25">{{ criterion_i.name }}</span>
                                        {% for criterion_j, cell in criteria.items %}
<!--                                        {{criterion_i}}:{{criterion_j}}={{cell.value}}-->
                                        <input {%if cell.id_i == cell.id_j %} disabled="disabled" readonly="readonly" {% endif %}
                                               id="object-descartes-{{ criterion_i.id }}-value" type="number" name="object-descartes-{{ cell.id }}-value"
                                               class="form-control {% if cell.changed %}text-warning{% endif %}"
                                               min="1" max="9" step='1' value="{{cell.value}}" onchange="this.form.submit()"/>
                                        {% endfor %}
                                    </div>
                                    {% endfor %}
                                </td>
                            </tr>
                            {% endif %}
                            {% endif %}

                            {% if show_need_descartes_item %}
                            {% if items %}
                            <tr>
                                <td>
                                    <tr>
                                        {% for criterion, items in cells_descartes_items.items %}
                                        <td>
                                            <div class="input-group flex-nowrap">
                                                <span class="input-group-text w-25">{{ criterion }}</span>
                                                {% for item in items %}
                                                <span class="form-control input-group-text">{{ item.name }}</span>
                                                {% endfor %}
                                            </div>
                                            {% for item_i, item in items.items %}
                                            <div class="input-group flex-nowrap">
                                                <span class="input-group-text w-25">{{ item_i.name }}</span>
                                                {% for item_j, cell in item.items %}
                                                <input {%if cell.id_i == cell.id_j %} disabled="disabled" readonly="readonly" {% endif %}
                                                       id="object-descartes_item-{{ item_i.id }}-value" type="number" name="object-descartes_item-{{ cell.id }}-value"
                                                       class="form-control {% if cell.changed %}text-warning{% endif %}"
                                                       min="1" max="9" step='1' value="{{cell.value}}" onchange="this.form.submit()"/>

                                                {% endfor %}
                                            </div>
                                            {% endfor %}
                                        </td>
                                        {% if forloop.counter|divisibleby:2 %}
                                    </tr>
                                    <tr>
                                        {% endif %}
                                        {% endfor %}
                                    </tr>
                                </td>
                            </tr>
                            {% endif %}
                            {% endif %}
                        </table>
                        {% endif %}
                    </form>
                </div>
                {% if task_result.items %}
                <div class="card-footer">
                    <div class="list-group">
                        {% for method, item in task_result.items %}

                        <span class="align-middle list-group-item list-group-item-action list-group-item-primary d-flex justify-content-between">
                            <div class="d-flex align-items-center">
                                {{ method }}
                            </div>
                                <span class="badge bg-primary align-middle">{{ item }}</span>
                        </span>

                        {% endfor %}
                    </div>
<!--                    <ul class="list-group">-->
<!--                        {% for method, item in task_result.items %}-->
<!--                        <li class="list-group-item d-flex justify-content-between align-items-center">-->
<!--                            {{ method }}-->
<!--                            <div class="badge bg-primary text-wrap" style="width: 6rem;">-->
<!--                                {{ item }}-->
<!--                            </div>-->
<!--                            <h5><span class="badge bg-secondary">{{ item }}</span></h5>-->
<!--                        </li>-->
<!--                        {% endfor %}-->
<!--                    </ul>-->
                </div>
                {% endif %}
            </div>
        </div>
        <div class="col"></div>
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="col"></div>
        <div class="col">
            <div class="row">
                <div class="col">
                </div>
            </div>

        </div>
        <div class="col"></div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
{% endblock content %}